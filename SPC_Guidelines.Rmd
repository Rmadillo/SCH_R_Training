---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

require(ggplot2)
require(ggExtra)

```

# Guidance on the Use of Control Charts for Quality Improvement and Monitoring


Control charts are meant to help you identify departures from a stable process. Run charts help you monitor any sort of time series data.  

In many cases, a run chart may be all you need.   

| Use a run chart if | Use a control chart if |
| ------------------------------------ | ------------------------------------- |
| You are monitoring a process that contains trends or seasonality | You are monitoring a stable statistical process (there is no trend or autocorrelation in the time series, or you have made the appropriate corrections to account for trends or seasonality) |
| You have no expectations that normal day-to-day operations will affect the trend | You expect that normal day-to-day operations will or are meant to keep the process steady |
| You do not need to account for the inherent natural variation in the system | You need to understand and account for the inherent natural variation ("noise") in the system | 
| You have at least 3 data points | You have about 20 or more data points that are in a stable statistical process, or you have performed a power analysis that provides the appropriate n for the appropriate time interval | 
| You want to monitor the behavior of individual or groups of data points to a reference, target, or goal level | You want to monitor the "average" of the system's behavior (i.e., the underlying statistical process)â€”deviations from expectations | 
| You may or may not investigate or act when a data point crosses a reference, target, or goal level | You intend to investigate or act when the process moves outside of control | 
| You have little control over or cannot control the metric (e.g., ED volume/acuity) | You have the potential to control the process driving the metric (e.g., ED wait times) | 
| | You understand the practical trade-offs between the sensitivity and specificity of the control limits relative to your need to investigate or act |
| | You know which statistical distribution to use to calculate the control limits to ensure you have the proper mean-variance relationship |


### Natural variation and control charts

### Tips and Tricks

- Carefully define your numerator and denominator. Evaluate each separately over time to see whether there are any unusual features or patterns. Sometimes patterns can occur in one or the other than disappear when coalesced into a rate or proportion.  

- Ensure your control limits make sense. For example, if you have proportion data and your control limits fall above 100 or below 0, there's clearly an error somewhere. Ditto with negative counts.  

- For continuous data, the definition of the control limits will depend on your question and the data at hand.    

- For count data, prefer u-charts to c-charts. In most cases, we do not have a constant denominator, so c-charts would not be appropriate. Even when we do, using a u-chart helps reduce audience confusion because you are explicitly stating the "per *x*".    

- For proportion data, prefer p-charts to np-charts. Again, we almost never have a constant denominator, so np-charts would not be appropriate. Even when we do, using a p-chart helps reduce audience confusion by explicitly stating the "per *x*".   

- For raw ordinal data (such as likert scores), do not use means or control limits. Just. Don't. If you must plot a single value, convert to a proportion (e.g., "top box scores") first. However, stacked bar or mosaic charts describe this kind of data much better, and can be done in the same amount of space.  


### Count, proportion, or rate data

| If your data involve... | use a ... | based on the ... distribution. | 
| ----------------------------- | --------- | ----------------------------- | 
| Rates (with unequal opportunity/variable denominator) | u chart | Poisson | 
| Counts (with equal opportunity/constant denominator) | c chart | Poisson |
| Proportions (with unequal opportunity/variable denominator) | p chart | binomial |
| Proportions (with equal opportunity/constant denominator) | np chart | binomial | 

In each case, the center line will be the arithmatic mean of the data window of interest. Rather than using $\bar{x}$ abbreviation, these values are usually named for each type of chart to help emphasize the use of control limits that are *not* based on the normal distribution.    

Control limits (3&sigma;) are calculated as follows:  

**Rates (u):** $3\sqrt{\frac{u}{n_i}}$   

**Counts (c):** $3\sqrt{c}$  

**Proportions (p):** $3\sqrt{\frac {p (1 - p)}{n_i}}$  



### Continuous data 







### Testing assumptions

```{r assumpt}
# Autocorrelation
acf(df$y)

# Linear trend (not flat)
summary(lm(y ~ x, data = df))
```
